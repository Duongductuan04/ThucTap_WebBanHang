@using SimpleTaskApp.MobilePhones.Dto
@using SimpleTaskApp.Areas.Admin.Models.Common.Modals
@using SimpleTaskApp.Areas.Admin.Models.Discounts
@model EditDiscountViewModel

@{
    Layout = null;
}

@await Html.PartialAsync(
        "~/Areas/Admin/Views/Shared/Modals/_ModalHeader.cshtml",
        new ModalHeaderViewModel(L("EditDiscount"))
)

<form id="DiscountEditForm" role="form" class="form-horizontal" method="post">
    <input type="hidden" name="Discount.Id" value="@Model.Discount.Id" />
    <div class="modal-body">

        <!-- Name -->
        <div class="form-group row required">
            <label class="col-md-3 col-form-label" for="Name">@L("Name")</label>
            <div class="col-md-9">
                <input id="Name" name="Discount.Name" type="text" class="form-control" maxlength="256" required
                       value="@Model.Discount.Name"
                       data-val="true" data-val-required="@L("Name_Required")"
                       data-val-maxlength="@L("Name_MaxLength")" data-val-maxlength-max="256"
                       data-val-regex="@L("Name_Invalid")" data-val-regex-pattern="^[a-zA-Z0-9\s]+$" />
                <span class="text-danger field-validation-valid" data-valmsg-for="Discount.Name" data-valmsg-replace="true"></span>
            </div>
        </div>

        <!-- Code -->
        <div class="form-group row required">
            <label class="col-md-3 col-form-label" for="Code">@L("Code")</label>
            <div class="col-md-9">
                <input id="Code" name="Discount.Code" type="text" class="form-control" maxlength="50" required
                       value="@Model.Discount.Code"
                       data-val="true" data-val-required="@L("Code_Required")"
                       data-val-maxlength="@L("Code_MaxLength")" data-val-maxlength-max="50" />
                <span class="text-danger field-validation-valid" data-valmsg-for="Discount.Code" data-valmsg-replace="true"></span>
            </div>
        </div>

        <!-- Percentage -->
        <div class="form-group row">
            <label class="col-md-3 col-form-label" for="Percentage">@L("Percentage")</label>
            <div class="col-md-9">
                <input id="Percentage" name="Discount.Percentage" type="number" class="form-control" step="0.01" min="0" max="100"
                       value="@(Model.Discount.Percentage.HasValue ? Model.Discount.Percentage.Value.ToString("0.00") : "")"
                       data-val="true" data-val-range="@L("Percentage_Invalid")" data-val-range-min="0" data-val-range-max="100" />
                <span class="text-danger field-validation-valid" data-valmsg-for="Discount.Percentage" data-valmsg-replace="true"></span>
            </div>
        </div>

        <!-- Amount -->
        <div class="form-group row">
            <label class="col-md-3 col-form-label" for="Amount">@L("Amount")</label>
            <div class="col-md-9">
                <input id="Amount" name="Discount.Amount" type="number" class="form-control" step="0.01" min="0"
                       value="@(Model.Discount.Amount.HasValue ? Model.Discount.Amount.Value.ToString("0.00") : "")"
                       data-val="true" data-val-range="@L("Amount_Invalid")" data-val-range-min="0" />
                <span class="text-danger field-validation-valid" data-valmsg-for="Discount.Amount" data-valmsg-replace="true"></span>
            </div>
        </div>

        <!-- ApplyType -->
        <div class="form-group row required">
            <label class="col-md-3 col-form-label" for="ApplyType">@L("ApplyType")</label>
            <div class="col-md-9">
                @{
                    var applyTypes = new List<SelectListItem>
                    {
                        new SelectListItem { Value = "0", Text = L("All"), Selected = Model.Discount.ApplyType == 0 },
                        new SelectListItem { Value = "1", Text = L("Category"), Selected = Model.Discount.ApplyType == 1 },
                        new SelectListItem { Value = "2", Text = L("Product"), Selected = Model.Discount.ApplyType == 2 }
                    };
                }
                @Html.DropDownList("Discount.ApplyType", applyTypes, new { @class = "form-control", id = "ApplyType", required = "required", data_val = "true", data_val_required = L("ApplyType_Required") })
            </div>
        </div>

        <!-- Category Select -->
        <div class="form-group row category-select" style="display:@(Model.Discount.ApplyType == 1 ? "block" : "none");">
            <label class="col-md-3 col-form-label">@L("SelectCategories")</label>
            <div class="col-md-9">
                <select name="Discount.Categories" class="form-control" multiple data-val="true" data-val-required="@L("Category_Required")">
                    @foreach (var c in Model.Categories)
                    {
                        var isSelected = Model.SelectedCategoryIds != null && Model.SelectedCategoryIds.Contains(int.Parse(c.Value));
                        <option value="@c.Value" selected="@(isSelected ? "selected" : null)">@c.Text</option>
                    }
                </select>
                <span class="text-danger field-validation-valid" data-valmsg-for="Discount.Categories" data-valmsg-replace="true"></span>
            </div>
        </div>

        <!-- Product Select -->
        <div class="form-group row product-select" style="display:@(Model.Discount.ApplyType == 2 ? "block" : "none");">
            <label class="col-md-3 col-form-label">@L("SelectProducts")</label>
            <div class="col-md-9">
                <select name="Discount.Products" class="form-control" multiple data-val="true" data-val-required="@L("Product_Required")">
                    @foreach (var p in Model.Products)
                    {
                        var isSelected = Model.SelectedProductIds != null && Model.SelectedProductIds.Contains(int.Parse(p.Value));
                        <option value="@p.Value" selected="@(isSelected ? "selected" : null)">@p.Text</option>
                    }
                </select>
                <span class="text-danger field-validation-valid" data-valmsg-for="Discount.Products" data-valmsg-replace="true"></span>
            </div>
        </div>

        <!-- MinOrderValue -->
        <div class="form-group row">
            <label class="col-md-3 col-form-label" for="MinOrderValue">@L("MinOrderValue")</label>
            <div class="col-md-9">
                <input id="MinOrderValue" name="Discount.MinOrderValue" type="number" class="form-control" step="0.01" min="0"
                       value="@(Model.Discount.MinOrderValue.ToString("0.00"))"
                       data-val="true" data-val-range="@L("MinOrderValue_Invalid")" data-val-range-min="0" />
                <span class="text-danger field-validation-valid" data-valmsg-for="Discount.MinOrderValue" data-valmsg-replace="true"></span>
            </div>
        </div>

        <!-- MaxUsage -->
        <div class="form-group row">
            <label class="col-md-3 col-form-label" for="MaxUsage">@L("MaxUsage")</label>
            <div class="col-md-9">
                <input id="MaxUsage" name="Discount.MaxUsage" type="number" class="form-control" min="0"
                       value="@(Model.Discount.MaxUsage.ToString())"
                       data-val="true" data-val-range="@L("MaxUsage_Invalid")" data-val-range-min="0" />
                <span class="text-danger field-validation-valid" data-valmsg-for="Discount.MaxUsage" data-valmsg-replace="true"></span>
            </div>
        </div>

        <!-- StartDate -->
        <div class="form-group row required">
            <label class="col-md-3 col-form-label" for="StartDate">@L("StartDate")</label>
            <div class="col-md-9">
                <input id="StartDate" name="Discount.StartDate" type="datetime-local" class="form-control"
                       value="@(Model.Discount.StartDate != null ? Model.Discount.StartDate.ToString("yyyy-MM-ddTHH:mm") : "")" />
            </div>
        </div>

        <!-- EndDate -->
        <div class="form-group row required">
            <label class="col-md-3 col-form-label" for="EndDate">@L("EndDate")</label>
            <div class="col-md-9">
                <input id="EndDate" name="Discount.EndDate" type="datetime-local" class="form-control"
                       value="@(Model.Discount.EndDate != null ? Model.Discount.EndDate.ToString("yyyy-MM-ddTHH:mm") : "")" />
            </div>
        </div>

        <!-- IsActive -->
        <div class="form-group row">
            <label class="col-md-3 col-form-label" for="IsActive">@L("IsActive")</label>
            <div class="col-md-9">
                <input type="hidden" name="Discount.IsActive" value="false" />
                <input id="IsActive" name="Discount.IsActive" type="checkbox" value="true" @(Model.Discount.IsActive ? "checked" : "") />
            </div>
        </div>

    </div>

    @await Html.PartialAsync("~/Areas/Admin/Views/Shared/Modals/_ModalFooterWithSaveAndCancel.cshtml")
</form>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<script src="~/view-resources/Views/MobilePhones/_EditModal.js" asp-append-version="true"></script>
